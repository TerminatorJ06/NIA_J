<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.Arch. Curriculum & Technology Planner (5-Year) - Nitte University (Google Drive Sync)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <!-- Optional: for icons -->

    <!-- Google Identity Services and Google API Client Library -->
    <!-- The onload functions are defined later in the script -->
    <script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>


    <style>
        /* --- Start of Refined CSS v7 (with Google Drive Additions) --- */
        :root {
            --primary-color: #0077b6; /* Slightly softer blue */
            --primary-dark: #023e8a;
            --secondary-color: #48cae4; /* Complementary lighter blue */
            --secondary-dark: #0096c7;
            --text-color: #333;
            --heading-color: #1a202c; /* Even darker blue-grey */
            --background-color: #f4f7f6; /* Light grey background */
            --container-bg: #fff;
            --border-color: #e9ecef; /* Lighter border grey */
            --light-grey: #f8f9fa; /* Very light grey */
            --medium-grey: #ced4da; /* Medium grey for borders/dividers */
            --dark-grey: #6c757d; /* Slightly darker grey for helper text */
            --editable-bg: #fffbe6; /* Soft yellow for editable */
            --highlight-color: #e0f7fa; /* Very light blue highlight on focus */
            --delete-color: #e74c3c; /* Red */
            --delete-dark: #c0392b;

            /* New color for unused themes */
            --unused-bg: #f8d7da; /* Very light red background */
            --unused-text: #721c24; /* Darker red text */
            --unused-border: #f5c6cb; /* Medium red border */

             /* New color for summary tables */
             --summary-bg: #eef2f7; /* Match header background */
             --summary-header-bg: var(--primary-color);
             --summary-header-text: white;

             /* Google Drive Button Style */
             --google-blue: #4285F4;
             --google-blue-dark: #357ae8;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 25px 20px; /* More vertical padding */
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 15px; /* Slightly smaller base size */
        }

        .curriculum-planner {
            max-width: 1800px; /* Max width of the main container */
            margin: 20px auto;
            background-color: var(--container-bg);
            padding: 40px 50px; /* Increased padding */
            border-radius: 12px; /* Slightly more rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Softer, wider shadow */
            /* Allow container to shrink below max-width if needed for smaller screens */
             width: auto;
        }

        h1, h2 {
             text-align: center;
             color: var(--heading-color);
             font-weight: 600;
        }
        h1 { font-size: 2.4em; margin-bottom: 10px; margin-top: 0;}
        h2 { font-size: 1.4em; margin-bottom: 45px; font-weight: 400; color: var(--dark-grey); }

        h3 { /* Semester Titles */
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 12px; /* More padding below title */
            margin-top: 60px; /* More space above sections */
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.7em;
        }
         h4 { /* General Notes Title & Summary Title */
            color: var(--heading-color);
            margin-top: 50px;
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 500; /* Slightly less bold */
         }

        .semester-summary {
            font-size: 0.95em;
            font-style: italic;
            color: var(--dark-grey);
            margin-top: 10px;
            margin-bottom: 35px; /* More space below summary */
            padding: 18px 25px; /* Increased padding */
            background-color: var(--light-grey);
            border-left: 5px solid var(--primary-color); /* Wider border */
            border-radius: 5px; /* Slightly more rounded */
            min-height: 45px; /* Ensure clickable area */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
             line-height: 1.5; /* Slightly more open line height */
             white-space: pre-wrap; /* Ensure line breaks are respected */
             text-align: left; /* Changed from center */
        }
        .semester-summary[contenteditable="true"] {
            background-color: var(--editable-bg);
            cursor: text;
             font-style: normal; /* Remove italic when editing */
        }
        .semester-summary[contenteditable="true"]:focus {
             outline: none;
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2); /* Softer, blue outline */
             background-color: var(--container-bg);

        }

        p.instructions {
            display: block;
            text-align: center;
            margin-bottom: 45px; /* More space below instructions */
            color: var(--dark-grey);
            font-size: 0.9em;
            font-style: italic;
            line-height: 1.5;
        }
         p.warning {
             color: var(--delete-dark);
             font-weight: 500;
             text-align: center;
             margin-bottom: 25px;
         }


        /* Table Container for Responsiveness */
        .table-responsive {
            width: 100%; /* Take full width of parent */
            overflow-x: auto; /* Enable horizontal scrolling */
            margin-bottom: 25px; /* More space below table */
            border: 1px solid var(--border-color); /* Add light border to container */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Subtle shadow */
             /* min-width defined within specific table-responsive styles */
        }

         /* Specific min-width for curriculum tables */
        .semester-section .table-responsive {
             min-width: 1700px; /* Increased min-width to make table wider */
        }

         /* Scrollbar styling */
        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }
        .table-responsive::-webkit-scrollbar-thumb {
            background: var(--medium-grey);
            border-radius: 10px;
        }
        .table-responsive::-webkit-scrollbar-track {
            background: var(--light-grey);
        }
         .table-responsive table {
             border: none; /* Remove inner table border as container has one */
             width: 100%; /* Table fills the min-width of its container */
             table-layout: fixed; /* Keep fixed layout for controlled columns */
         }

        /* Planner Table Styles */
        table {
            border-collapse: collapse;
            font-size: 0.9em; /* Slightly smaller table font */
        }

        th, td {
            border: 1px solid var(--border-color); /* Lighter inner borders */
            padding: 14px 12px; /* More padding */
            text-align: left;
            vertical-align: top; /* Keep top alignment for text cells */
            word-wrap: break-word;
            overflow-wrap: break-word;
             line-height: 1.5; /* Open line height in cells */
        }

        th {
            background-color: #eef2f7; /* Very light blueish-grey header */
            color: var(--heading-color);
            font-weight: 600;
            vertical-align: middle; /* Keep middle for header text/small */
            position: sticky;
            top: 0;
            z-index: 1;
            border-bottom: 2px solid var(--medium-grey); /* Stronger bottom border */
        }
         th small {
             display: block;
             font-weight: 400;
             font-size: 0.8em; /* Smaller hint text */
             color: var(--dark-grey);
             margin-top: 5px;
         }

        /* Apply specific widths to columns (12 columns including Delete) */
        /* Adjusted widths to provide more space for notes/remarks */
        .semester-section th:nth-child(1), .semester-section td:nth-child(1) { width: 4%; }  /* Code */
        .semester-section th:nth-child(2), .semester-section td:nth-child(2) { width: 11%; } /* Title */
        .semester-section th:nth-child(3), .semester-section td:nth-child(3) { width: 4%; text-align: center; } /* Credits */
        .semester-section th:nth-child(4), .semester-section td:nth-child(4) { width: 6%; }  /* Default RIBA (D) */
        .semester-section th:nth-child(5), .semester-section td:nth-child(5) { width: 6%; }  /* Acad/Prac RIBA (D) */
        .semester-section th:nth-child(6), .semester-section td:nth-child(6) { width: 12%; } /* Acad/Prac Notes */
        .semester-section th:nth-child(7), .semester-section td:nth-child(7) { width: 6%; }  /* Ethics RIBA (D) */
        .semester-section th:nth-child(8), .semester-section td:nth-child(8) { width: 12%; } /* Ethics Notes */
        .semester-section th:nth-child(9), .semester-section td:nth-child(9) { width: 6%; }  /* Tech RIBA (D) */
        .semester-section th:nth-child(10), .semester-section td:nth-child(10){ width: 12%; }/* Tech Notes */
        .semester-section th:nth-child(11), .semester-section td:nth-child(11){ width: 6%; }  /* Remarks */
        .semester-section th:nth-child(12), .semester-section td:nth-child(12){ width: 2%; text-align: center;} /* Actions */


        tbody tr:nth-child(even) {
            background-color: var(--f8f9fa); /* Very subtle zebra striping */
        }

        tbody tr:hover:not(.total-credits-row) {
            background-color: var(--highlight-color); /* Light blue hover */
        }

        td[contenteditable="true"] {
            background-color: var(--container-bg);
            cursor: text;
            min-height: 35px; /* Ensure space for editing */
            outline: none;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
             white-space: pre-wrap; /* Ensure line breaks are respected */
        }

        td[contenteditable="true"]:hover {
             background-color: var(--editable-bg); /* Hint on hover */
        }

        td[contenteditable="true"]:focus {
            background-color: var(--highlight-color);
            box-shadow: inset 0 0 0 1px var(--primary-color); /* Inner border on focus */
        }

        /* Styling for RIBA dropdown cell */
        td.riba-cell {
             background-color: var(--container-bg);
             padding: 8px 6px; /* Adjusted padding for select */
             vertical-align: top; /* Changed from middle */
             min-height: 35px; /* Match other editable cells */
        }

        select.riba-select {
            width: 100%;
            padding: 8px 6px; /* Adjusted padding */
            border: 1px solid var(--medium-grey);
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9em;
            background-color: var(--container-bg);
            box-sizing: border-box;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center; /* More space for arrow */
            background-size: 12px auto; /* Slightly larger arrow */
            cursor: pointer;
             vertical-align: top; /* Ensure select box itself aligns top */
        }
        select.riba-select:focus {
             outline: none;
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
        }
         select.riba-select option {
             padding: 4px;
         }


        /* Styling for the total credits row */
        .total-credits-row td {
            background-color: #e9ecef;
            font-weight: 600; /* Slightly less bold */
            color: var(--heading-color);
            border-top: 2px solid var(--medium-grey);
            vertical-align: middle;
            padding: 14px 12px; /* Match row padding */
        }
        .total-credits-row td:first-child { text-align: right; padding-right: 20px;} /* More space */
        .total-credits-row td:nth-child(2) { /* Total Credits Number */
            font-size: 1.1em;
            text-align: center;
            font-weight: 700; /* Make number bolder */
            color: var(--primary-dark); /* Highlight total */
        }
         /* The third TD in total row now spans the remaining columns visually */
        .total-credits-row td:nth-child(3) {
             background-color: transparent;
        }


        /* General Notes Area */
        #general-notes-section {
             margin-top: 60px; /* More space above */
        }
        #general-notes-area {
            width: 100%;
            min-height: 200px; /* Taller textarea */
            padding: 15px;
            border: 1px solid var(--medium-grey);
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            box-sizing: border-box;
            resize: vertical;
             outline: none;
             transition: border-color 0.3s ease, box-shadow 0.3s ease;
             line-height: 1.6;
             white-space: pre-wrap; /* Ensure line breaks */
        }
         #general-notes-area:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
         }

        /* Buttons */
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 13px 28px; /* Slightly larger padding */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            border-radius: 6px; /* Slightly more rounded */
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
            margin-top: 20px; /* More space above buttons */
            margin-right: 10px;
            font-weight: 500; /* Medium weight */
        }

        button:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        button:active {
             background-color: #00548c;
             box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }


        /* Google Drive Specific Button Styles */
        #google-drive-buttons button {
             background-color: var(--google-blue);
        }
         #google-drive-buttons button:hover {
             background-color: var(--google-blue-dark);
         }
          #google-drive-buttons button:active {
             background-color: #1a5cdb; /* Slightly darker */
          }

        /* Hide buttons conditionally */
         #sign-in-button[hidden] { display: none; }
         #sign-out-button[hidden] { display: none; }
         /* Hide save/load buttons completely if API isn't loaded */
         #save-to-drive-button[hidden] { display: none; }
         #load-from-drive-button[hidden] { display: none; }


        .add-course-button-container {
             margin-top: 15px; /* Space above add button */
             text-align: left; /* Align add button left */
        }
         .action-buttons {
             text-align: center;
             margin-top: 50px; /* More space above global action buttons */
         }
        .google-drive-status {
             text-align: center;
             margin-top: 10px;
             font-size: 0.9em;
             color: var(--dark-grey);
             min-height: 1.2em; /* Reserve space */
        }


        /* Delete button specific styles */
        td.delete-cell {
             text-align: center;
             vertical-align: middle;
             padding: 10px 6px; /* Adjusted padding to be less */
        }
        .delete-row-button {
             background: none;
             border: none;
             color: var(--delete-color); /* Red color for delete */
             font-size: 1.3em; /* Slightly larger icon */
             cursor: pointer;
             padding: 4px; /* Reduced padding */
             margin: 0;
             transition: color 0.2s ease;
             line-height: 1;
             display: inline-flex;
             align-items: center;
             justify-content: center;
        }
        .delete-row-button:hover {
             color: var(--delete-dark);
             background: none;
             box-shadow: none;
        }
         .delete-row-button:active {
             color: #a93226; /* Even darker red */
             background: none;
             box-shadow: none;
         }

        /* New styles for Unused RIBA Themes section */
        .unused-riba-section {
            margin-top: 25px;
            margin-bottom: 30px;
            padding: 15px 20px;
            background-color: var(--unused-bg);
            border: 1px solid var(--unused-border);
            border-radius: 5px;
            font-size: 0.9em;
            color: var(--unused-text);
            line-height: 1.5;
        }
         .unused-riba-section p {
             margin: 0; /* Remove default paragraph margin */
             white-space: pre-wrap; /* Preserve line breaks if needed */
         }
         .unused-riba-section strong {
             color: var(--unused-text); /* Ensure title is also dark red */
         }

        /* New styles for RIBA Summary Table section */
        .riba-summary-section {
             margin-top: 60px; /* Space above this section */
             margin-bottom: 40px; /* Space below */
        }

        .riba-summary-section .table-responsive {
             /* Adjust min-width if needed, but 12 columns might fit better than 1700px */
             min-width: 1000px; /* Example smaller min-width for summary */
        }


        #riba-summary-table th {
             background-color: var(--summary-header-bg); /* Darker blue for summary header */
             color: var(--summary-header-text); /* White text */
             font-weight: 600;
             border-color: var(--primary-dark); /* Stronger border */
             text-align: center; /* Center header text */
             vertical-align: middle;
             padding: 10px 8px; /* Slightly less padding than main table headers */
        }
         #riba-summary-table th:first-child {
             text-align: left; /* Align theme name left */
             background-color: #eef2f7; /* Match main table header background */
             color: var(--heading-color); /* Match main table header text */
             border-color: var(--medium-grey);
             position: sticky; /* Sticky theme column */
             left: 0;
             z-index: 2; /* Higher z-index than sticky header */
         }

         #riba-summary-table td {
             text-align: center; /* Center count numbers */
             vertical-align: middle;
             padding: 8px 6px; /* Less padding for numbers */
             background-color: var(--summary-bg); /* Light background for body */
         }

         #riba-summary-table tbody tr:nth-child(even) td {
              background-color: var(--light-grey); /* Subtle zebra for rows */
         }

         #riba-summary-table td:first-child {
              text-align: left; /* Align theme name left */
              font-weight: 500; /* Medium weight for theme name */
              background-color: var(--container-bg); /* White background for theme cell */
              position: sticky; /* Sticky theme cell */
              left: 0;
              z-index: 1; /* Lower z-index than sticky header */
         }
         #riba-summary-table tr:hover td {
             background-color: var(--highlight-color); /* Highlight on hover */
         }
          #riba-summary-table tr:hover td:first-child {
             background-color: var(--highlight-color); /* Ensure sticky cell also highlights */
          }


        /* Optional: Toast/Notification for save */
        .save-notification {
            position: fixed;
            bottom: 25px; /* Higher from bottom */
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745; /* Success green */
            color: white;
            padding: 14px 25px; /* More padding */
            border-radius: 6px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             font-size: 1em;
             font-weight: 500;
             max-width: 80%; /* Prevent overflow on small screens */
             text-align: center;
        }
        .save-notification.show {
            opacity: 1;
            visibility: visible;
        }
         .save-notification.error {
             background-color: #dc3545; /* Error red */
         }
          .save-notification.info {
             background-color: #ffc107; /* Warning yellow */
              color: #343a40;
         }
         .save-notification.info.show {
            opacity: 1; visibility: visible;
            background-color: #ffc107; /* Warning yellow */
            color: #343a40;
         }


        /* Ensure textarea in notes/remarks preserves spaces */
        /* This is handled by white-space: pre-wrap and innerHTML/value */

        /* --- End of Refined CSS v7 --- */
    </style>
</head>
<body>

<div class="curriculum-planner">
    <h1>B.Arch. Curriculum Planner 2025</h1>
    <h2>Nitte Institute of Architecture - Based on Batch 2020-21 Regulations</h2>
    <p class="instructions"><em>Click on table cells or summary paragraphs to edit. Use dropdowns for Default and Direct RIBA theme connections. Credit totals update automatically. Unused RIBA themes per semester are listed below each table. Changes are automatically saved to your browser's storage and Google Drive (if signed in). Delete rows using the <span style="color: var(--delete-color); font-weight: 600;">&times;</span> button in the Actions column.</em></p>
     <p class="warning"><strong>Important:</strong> This planner is designed for a single user. If multiple people edit the same file in Google Drive concurrently, changes may be overwritten without warning.</p>


    <!-- Google Drive Actions -->
    <div class="action-buttons" id="google-drive-buttons">
        <button id="sign-in-button">Sign In with Google</button>
        <button id="sign-out-button" hidden>Sign Out</button>
        <!-- Save/Load buttons hidden by default, shown if API loads and user signs in -->
        <button id="save-to-drive-button" hidden disabled>Manual Save to Drive</button>
        <button id="load-from-drive-button" hidden disabled>Manual Load from Drive</button>
    </div>
     <div class="google-drive-status" id="google-drive-status">Loading Google API...</div>


    <!-- --- Semester Tables (Sem 1 to 10) --- -->

    <!-- Semester 1 -->
    <div class="semester-section">
        <h3>Semester 1 (Level 1: Foundation)</h3>
        <p class="semester-summary" id="sem1-summary" contenteditable="true">
            **Overall Theme:** Fundamentals of Design and Representation<br>
            **Focus:** This semester lays the essential groundwork for the entire program. The focus is on developing fundamental visual literacy, manual and basic digital representation skills, introducing foundational design concepts, and understanding the basic physics influencing the built environment. It's about learning the initial language and tools of architecture. Successful completion is crucial as it provides the basic toolkit required for all subsequent design and technical studies.
        </p>
        <div class="table-responsive">
        <table id="sem1-table">
            <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR11</td>
                    <td contenteditable="true" spellcheck="false">Foundation Studio</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Intro Digital Fabrication (3D Print, Laser Cut workshop). Digital Models.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td> <!-- Delete Button -->
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR12</td>
                    <td contenteditable="true" spellcheck="false">Culturescapes</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR13</td>
                    <td contenteditable="true" spellcheck="false">Environment and Building Physics</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Basic Climate Analysis Tools (Climate Consultant or similar). Climate Data Viz.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR14</td>
                    <td contenteditable="true" spellcheck="false">Architectural and Visual Representation</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Intro 2D CAD (AutoCAD). Digital Graphics & Presentation (Adobe PS, AI, ID).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <!-- Total Credits Row -->
                <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 1 Total</strong></td>
                    <td><strong>0</strong></td> <!-- Credits Total -->
                    <td colspan="9"></td> <!-- Spans remaining columns -->
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem1-table')">Add Course to Semester 1</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem1-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 2 -->
     <div class="semester-section">
        <h3>Semester 2 (Level 1: Foundation)</h3>
        <p class="semester-summary" id="sem2-summary" contenteditable="true">
            **Overall Theme:** Introduction to Architectural Design and Spatial Thinking<br>
            **Focus:** Building on the foundations of Sem 1, this semester introduces students to the core activity of architectural design within a simplified context. Emphasis is placed on developing spatial awareness, applying basic structural/environmental principles, and using both physical models and introductory 3D digital tools (like SketchUp) to explore form and space. The Communication course refines the representation skills acquired in Sem 1. This semester solidifies the transition from abstract principles to concrete design exploration and sets the stage for tackling more complex design problems in Level 2.
        </p>
        <div class="table-responsive">
        <table id="sem2-table">
            <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR21</td>
                    <td contenteditable="true" spellcheck="false">Introduction to Architectural Design</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Intro 3D Modeling (SketchUp). Digital Models + Physical Prototypes.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR22</td>
                    <td contenteditable="true" spellcheck="false">Architecture and Change</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR23</td>
                    <td contenteditable="true" spellcheck="false">Climate, Site and Superstructure</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Climate Data Viz.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR24</td>
                    <td contenteditable="true" spellcheck="false">Graphics and Communication</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Digital Drawing & Graphics (CAD, Adobe Suite).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 2 Total</strong></td>
                    <td><strong>0</strong></td>
                     <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem2-table')">Add Course to Semester 2</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem2-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 3 -->
    <div class="semester-section">
        <h3>Semester 3 (Level 2: Development)</h3>
        <p class="semester-summary" id="sem3-summary" contenteditable="true">
            **Overall Theme:** Integrated Design and Workflow Development<br>
            **Focus:** This semester marks the beginning of Level 2, focusing on developing more integrated design approaches. A key milestone is the mandatory introduction of BIM (Revit) within the studio, shifting from basic representation to integrated building information modeling. Technical courses delve deeper into environmental and structural principles with introductory simulation concepts. Electives offer initial exposure to computational design and coding, expanding the digital toolkit. This semester emphasizes connecting different aspects of architectural knowledge and introducing essential digital workflows for the rest of the program.
        </p>
        <div class="table-responsive">
        <table id="sem3-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR31</td>
                    <td contenteditable="true" spellcheck="false">S3 Vertical Studio</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Mandatory BIM Introduction (Revit). Intermediate Rendering & Collaboration (Enscape/V-Ray, Miro). Milestone.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR32</td>
                    <td contenteditable="true" spellcheck="false">History and Construction</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR33</td>
                    <td contenteditable="true" spellcheck="false">Environment and Building Structures</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Basic Env. Simulation (Ladybug Tools). Intro Structural Analysis concepts/SW (e.g., STAAD Pro, ETABS).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(One L2 Elective Recommended). Options: Intro Computational Design (Rhino + GH - Milestone), Python Basics (VAC?).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 3 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem3-table')">Add Course to Semester 3</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem3-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 4 -->
    <div class="semester-section">
        <h3>Semester 4 (Level 2: Development)</h3>
         <p class="semester-summary" id="sem4-summary" contenteditable="true">
            **Overall Theme:** Design of Habitable Environments<br>
            **Focus:** Applying the integrated workflow introduced in Sem 3, this semester focuses on the complex programmatic and spatial requirements of housing design. Students consolidate their BIM proficiency by developing detailed housing projects. Technical studies continue to build knowledge of building systems, incorporating basic simulation for specific aspects like lighting. This semester deepens the understanding of designing for human needs and provides a solid foundation for more specialized building types in later studios.
        </p>
        <div class="table-responsive">
        <table id="sem4-table">
             <thead>
                <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR41</td>
                    <td contenteditable="true" spellcheck="false">Housing Studio</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">BIM application (Revit - Milestone). Rendering & Collaboration (Enscape/V-Ray, Miro).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR42</td>
                    <td contenteditable="true" spellcheck="false">History and Urbanism 1</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR43</td>
                    <td contenteditable="true" spellcheck="false">Building Systems & Electrical Services</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Basic Lighting Simulation.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(One L2 Elective Recommended). Options: Continue Comp Design, Python, etc.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 4 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem4-table')">Add Course to Semester 4</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem4-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 5 -->
    <div class="semester-section">
        <h3>Semester 5 (Level 2: Development)</h3>
         <p class="semester-summary" id="sem5-summary" contenteditable="true">
            **Overall Theme:** Technical Resolution and Advanced Digital Exploration<br>
            **Focus:** This semester pushes students toward greater technical understanding and introduces more advanced digital methodologies. Detailing focuses on the practicalities of construction, while the studio and electives integrate sophisticated tools like computational design (Grasshopper) for complex forms/analysis, real-time rendering, and emerging technologies like AI and robotics. This semester deepens technical knowledge, broadens the digital skill set, and prepares students for the professional internship by exposing them to tools increasingly relevant in practice.
        </p>
        <div class="table-responsive">
        <table id="sem5-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                 <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR51</td>
                    <td contenteditable="true" spellcheck="false">S5 Vertical Studio</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Advanced BIM Application (Revit). Computational Design Application (Grasshopper for Form-finding, Analysis). Real-time Rendering (Lumion, D5 Render).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR52</td>
                    <td contenteditable="true" spellcheck="false">History and Urbanism 2</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR53</td>
                    <td contenteditable="true" spellcheck="false">Building Detailing & Valuation</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Advanced BIM Application (Revit Details).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L2)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(One L2 Elective Recommended). Options: Intro AI in Arch (Milestone, e.g., concepts, Rayan.design), Intro Digital Fab/Robotics (Workflows, CNC - Milestone).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 5 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                 </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem5-table')">Add Course to Semester 5</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem5-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 6 -->
    <div class="semester-section">
        <h3>Semester 6 (Level 2: Development)</h3>
         <p class="semester-summary" id="sem6-summary" contenteditable="true">
            **Overall Theme:** Applied Professional Practice<br>
            **Focus:** This is a dedicated semester for practical, real-world experience through a full-time internship. The focus shifts from academic learning to applying accumulated knowledge, skills, and digital proficiency (BIM, CAD, etc.) in a professional architectural office or related setting. It's a crucial period for understanding industry workflows, project management, ethical considerations, and communication within a team. This exposure bridges theory and practice, informing future academic choices and the final thesis project.
        </p>
        <div class="table-responsive">
        <table id="sem6-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR65</td>
                    <td contenteditable="true" spellcheck="false">Co-operative Learning</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">24</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Industry Software Exposure (Revit, CAD, etc.). Full semester internship/practical training.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 6 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem6-table')">Add Course to Semester 6</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem6-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 7 -->
    <div class="semester-section">
        <h3>Semester 7 (Level 3: Specialization & Application)</h3>
        <p class="semester-summary" id="sem7-summary" contenteditable="true">
            **Overall Theme:** Urban Scale and Specialized Exploration<br>
            **Focus:** Transitioning to Level 3, the focus expands to the urban scale, requiring new tools like GIS and advanced data analysis for site understanding. Technical studies introduce complex simulations (CFD, ENVI-met) for deeper environmental understanding. Crucially, Level 3 Electives allow students to begin specializing in areas like advanced computation, AI, robotics, or visualization. This semester is about handling complexity at a larger scale and charting individual pathways toward specialization, setting the stage for thesis research and advanced studios.
        </p>
        <div class="table-responsive">
        <table id="sem7-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR71</td>
                    <td contenteditable="true" spellcheck="false">Urban Studio / Exchange Studio</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">GIS (ArcGIS/QGIS). Data Viz. Photogrammetry SW.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR73</td>
                    <td contenteditable="true" spellcheck="false">Building Systems and Practices</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Advanced Simulation (DesignBuilder, Autodesk CFD, ENVI-met).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(Two Electives Recommended). Options: Adv. Comp Design, AI Apps (e.g., Rayan.design applications), Robotics in Fab, AR/VR, Adv. Viz.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(See above).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 7 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem7-table')">Add Course to Semester 7</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem7-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- Semester 8 -->
    <div class="semester-section">
        <h3>Semester 8 (Level 3: Specialization & Application)</h3>
        <p class="semester-summary" id="sem8-summary" contenteditable="true">
            **Overall Theme:** Research and Thematic Design Application<br>
            **Focus:** This semester allows students to apply their developing specialization and research skills within thematic vertical studios and the independent Dissertation. Studios offer options like Conservation, Sustainability, etc., where students can integrate specific advanced tools (Scan-to-BIM, advanced simulation, structural analysis software) relevant to the theme. The Dissertation focuses on developing research methodologies and critical thinking, often supported by digital analysis tools. This semester links specialized academic inquiry with targeted design exploration.
        </p>
        <div class="table-responsive">
        <table id="sem8-table">
            <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR81 X*</td>
                    <td contenteditable="true" spellcheck="false">Vertical Studio 2</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">12</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(Options: Adv. Design, Cons., Landscape, Sustain., Urban Housing). Tech applied contextually, e.g., Scan-to-BIM in Conservation, Simulation in Sustainability, Structural analysis (STAAD/ETABS), BIM Coordination (Navisworks?).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR83</td>
                    <td contenteditable="true" spellcheck="false">Management and Interior Systems</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">6</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR85</td>
                    <td contenteditable="true" spellcheck="false">Dissertation</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Research Tools, Data Analysis (Python/AI tools?).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(One Elective Recommended). Specialize based on Sem 7 choices.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 8 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem8-table')">Add Course to Semester 8</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem8-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 9 -->
     <div class="semester-section">
        <h3>Semester 9 (Level 3: Specialization & Application)</h3>
        <p class="semester-summary" id="sem9-summary" contenteditable="true">
            **Overall Theme:** Professional Consolidation and Practical Application<br>
            **Focus:** A second full-semester internship offers deeper engagement with professional practice. This period is crucial for consolidating all academic learning, including design, technical, and digital skills, in a real-world context. Students apply integrated BIM workflows, project management concepts, and ethical reasoning learned in previous semesters. The focus is on gaining confidence, understanding the business realities of practice, and preparing for entry into the profession immediately after graduation.
        </p>
        <div class="table-responsive">
        <table id="sem9-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR95</td>
                    <td contenteditable="true" spellcheck="false">Co-operative Learning</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">24</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Industry Software Exposure (Revit, CAD, etc.). Full semester internship/practical training.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 9 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem9-table')">Add Course to Semester 9</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem9-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

     <!-- Semester 10 -->
    <div class="semester-section">
        <h3>Semester 10 (Level 3: Specialization & Application)</h3>
        <p class="semester-summary" id="sem10-summary" contenteditable="true">
            **Overall Theme:** Mastery and Professional Readiness (Thesis/Capstone)<br>
            **Focus:** The final semester culminates in the Architectural Thesis or Capstone Project, a self-directed undertaking synthesizing all academic knowledge and practical internship experience. Students demonstrate mastery by applying advanced design methodologies, integrating complex technical systems (building on Sem 7), leveraging specialized digital tools based on project needs (computational design, simulation, fabrication, BIM coordination), and presenting their work professionally using advanced visualization techniques (VR/AR). The Professional Practice course directly addresses the business and ethical aspects of entering the profession, ensuring graduates are well-rounded and ready for licensure and practice.
        </p>
        <div class="table-responsive">
        <table id="sem10-table">
             <thead>
                 <tr> <!-- 12 Columns -->
                    <th>Code</th>
                    <th>Title</th>
                    <th>Credits</th>
                    <th>Default RIBA<br><small>(Main Theme)</small></th>
                    <th>Acad/Prac RIBA<br><small>(Direct)</small></th>
                    <th>Academic & Practice Notes</th>
                    <th>Ethics RIBA<br><small>(Direct)</small></th>
                    <th>Ethics & Comm. Notes</th>
                    <th>Tech RIBA<br><small>(Direct)</small></th>
                    <th>Tech Integration Notes</th>
                    <th>Remarks</th>
                    <th>x</th> <!-- Keeping header as "x" -->
                </tr>
            </thead>
            <tbody>
                 <tr> <!-- 12 Cells -->
                    <td contenteditable="true" spellcheck="false">20BAR 101X*</td>
                    <td contenteditable="true" spellcheck="false">Architectural Thesis / Capstone Project</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">15</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Deep Tech Integration (Chosen tools: GH, AI (Rayan.design?), Fab, Simulation e.g., TRNSYS - Milestone). Advanced Visualization & VR/AR for presentation. BIM Coordination (Navisworks?).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR 105</td>
                    <td contenteditable="true" spellcheck="false">Professional Practice</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">Digital Workflows, BIM Standards & Coordination (Navisworks), Collaboration tools (Miro, BIM360?).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(Two Electives Recommended). Final deep specialization.</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr>
                    <td contenteditable="true" spellcheck="false">20BAR YY EX*</td>
                    <td contenteditable="true" spellcheck="false">Elective* (L3/Open/Global)</td>
                    <td contenteditable="true" data-cell-type="credits" spellcheck="false">3</td>
                     <td class="riba-cell"><select class="riba-select"></select></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="riba-cell"><select class="riba-select"></select></td>
                    <td contenteditable="true" spellcheck="false">*(See above).</td>
                    <td contenteditable="true" spellcheck="false"></td>
                    <td class="delete-cell"><button class="delete-row-button" title="Delete Row">&times;</button></td>
                </tr>
                 <tr class="total-credits-row">
                    <td colspan="2"><strong>Semester 10 Total</strong></td>
                    <td><strong>0</strong></td>
                    <td colspan="9"></td>
                </tr>
            </tbody>
        </table>
        </div><!-- /.table-responsive -->
         <div class="add-course-button-container">
            <button onclick="addCourse('sem10-table')">Add Course to Semester 10</button>
         </div>
         <!-- Unused RIBA Themes Section -->
        <div class="unused-riba-section">
            <p><strong>Unused RIBA Themes in this Semester:</strong> <span id="sem10-unused-riba-list">Calculating...</span></p>
        </div>
    </div>

    <!-- --- RIBA Theme Usage Summary Table --- -->
    <div class="riba-summary-section">
        <h4>RIBA Theme Usage Summary</h4>
        <div class="table-responsive">
            <table id="riba-summary-table">
                <thead>
                    <tr>
                        <th>RIBA Theme</th>
                        <th>Sem 1</th>
                        <th>Sem 2</th>
                        <th>Sem 3</th>
                        <th>Sem 4</th>
                        <th>Sem 5</th>
                        <th>Sem 6</th>
                        <th>Sem 7</th>
                        <th>Sem 8</th>
                        <th>Sem 9</th>
                        <th>Sem 10</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div><!-- /.table-responsive -->
    </div>


    <!-- General Notes Section -->
    <div id="general-notes-section">
        <h4>General Notes</h4>
        <textarea id="general-notes-area" placeholder="Enter any overall notes about the curriculum plan, technology choices, RIBA mapping, or implementation here..." spellcheck="false"></textarea>
    </div>

    <!-- Save Notification -->
    <div id="save-notification" class="save-notification" role="alert"></div>

</div><!-- /.curriculum-planner -->

<script>
    /* --- Start of Refined JavaScript v8.3 (Auto-Save/Load) --- */
    const ribaThemes = [
        "Health & Life Safety", "Ethics", "Professional Practice", "Structures",
        "Construction", "Resources", "History", "Theory & Methodologies",
        "Design Pedagogies", "Architectural Expression", "Business Skills",
        "Climate Literacy", "Research Literacy"
    ];
     // Updated Key for this version (Google Drive requires a different approach, but keep localStorage for fallback/initial load)
    const localStorageKey = 'bArchCurriculumData_Nitte_V8yr_RIBA_GD'; // Version 8 key for localStorage fallback

     // Array of semester IDs for easier looping
    const semesterIds = ['sem1', 'sem2', 'sem3', 'sem4', 'sem5', 'sem6', 'sem7', 'sem8', 'sem9', 'sem10'];

    // --- Google Drive Configuration ---
    // ** IMPORTANT: Replace with your actual Google API Client ID **
    const GOOGLE_CLIENT_ID = '168997750221-o31j6hrmavdi9i198nkr7djo28e0ll8j.apps.googleusercontent.com'; // <-- !! REPLACE THIS !!
    // File name to use in Google Drive
    const PLANNER_FILE_NAME = 'BArchCurriculumPlannerData.json';
    // Scopes required for Drive API
    const SCOPES = 'https://www.googleapis.com/auth/drive.file'; // Grants access only to files created or opened by this app

    // --- Google Drive State Variables ---
    let tokenClient; // Google Identity Services client for getting tokens
    let accessToken = null; // Current access token obtained via GSI
    let plannerFileId = null; // ID of the planner file in Google Drive
    let isApiLoaded = false; // Flag to track if the GAPI client and Drive API are loaded

    // --- UI Elements ---
    const signInButton = document.getElementById('sign-in-button');
    const signOutButton = document.getElementById('sign-out-button');
    const saveToDriveButton = document.getElementById('save-to-drive-button'); // Keep for manual trigger if desired
    const loadFromDriveButton = document.getElementById('load-from-drive-button'); // Keep for manual trigger if desired
    const driveStatusElement = document.getElementById('google-drive-status');
    const notificationElement = document.getElementById('save-notification'); // Use the existing notification

    // --- Auto-Save Variables ---
    const AUTOSAVE_DELAY = 2000; // 2 seconds debounce delay
    let autosaveTimer = null;
    let pendingAutoSave = false; // Flag to indicate if changes are waiting to be saved

    // --- Helper Functions ---
    function setDriveStatus(message, type = 'info') {
        driveStatusElement.textContent = message;
         driveStatusElement.style.color = type === 'error' ? 'var(--delete-dark)' : type === 'success' ? 'var(--primary-dark)' : 'var(--dark-grey)';
         // console.log(`Drive Status: ${message}`); // Keep console log for debugging
    }

     // Show Save/Error Notification (Reusing the existing one)
     function showNotification(message, isError = false, isInfo = false) {
         notificationElement.textContent = message;
         notificationElement.classList.remove('error', 'info', 'show'); // Remove previous states

         if (isError) {
             notificationElement.classList.add('error');
         } else if (isInfo) {
             notificationElement.classList.add('info');
         }
         notificationElement.classList.add('show');

         // Hide after 3 seconds
         if (notificationElement._timer) clearTimeout(notificationElement._timer);
         notificationElement._timer = setTimeout(() => {
             notificationElement.classList.remove('show');
         }, 3000);

         // console.log(`Notification: ${message}`); // Keep console log for debugging
     }

    // --- Debounce Utility ---
    function debounce(func, delay) {
        let timer;
        return function(...args) {
            const context = this;
            pendingAutoSave = true; // Mark that there's a pending save
            clearTimeout(timer);
            timer = setTimeout(() => {
                pendingAutoSave = false; // Clear flag before executing
                func.apply(context, args);
            }, delay);
        };
    }

    // Debounced function for auto-saving (either to Drive or localStorage)
    const debouncedAutoSave = debounce(autoSave, AUTOSAVE_DELAY);


    // --- Google Identity Services Initialization ---
    // This function is called by the GSI script's onload attribute
    function gisLoaded() {
         // console.log("gisLoaded callback fired."); // Debug log
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: GOOGLE_CLIENT_ID,
            scope: SCOPES,
            callback: handleGsiCallback, // Use the dedicated callback
            prompt: '', // Request permissions explicitly when calling requestAccessToken
        });
         // console.log("GIS client initialized.");
         // Initial status update will happen after GAPI loads as well
    }

    // Dedicated callback for the GSI token client
    function handleGsiCallback(resp) {
        // console.log("handleGsiCallback fired with response:", resp); // Debug log
        if (resp.error) {
            // Handle authorization errors (user denied access, etc.)
            console.error('Authorization error:', resp.error);
             if (resp.error === 'popup_closed_by_user') {
                  setDriveStatus("Google sign-in popup closed.", 'info');
             } else if (resp.error === 'access_denied') {
                 setDriveStatus("Access to Google Drive denied.", 'error');
                  showNotification("Access to Google Drive denied. Cannot save/load.", true);
             } else {
                 setDriveStatus(`Sign-in error: ${resp.error}`, 'error');
                 showNotification(`Google Sign-in failed: ${resp.error_description || resp.error}`, true);
             }

            accessToken = null;
            gapi.client.setToken(null); // Ensure gapi client token is cleared
            updateSignInStatus();
            return;
        }

        // Authorization successful
        accessToken = resp.access_token;
        gapi.client.setToken({ access_token: accessToken }); // Set the token for gapi.client
        // console.log("Successfully signed in. Access Token obtained."); // Debug log

        // Now that we are signed in, if the API is loaded, we should load the latest data from Drive
        if (isApiLoaded) {
             setDriveStatus("Signed in. Loading data from Google Drive...", 'info');
             // Automatically load data from Drive upon successful sign-in
             loadDataFromDrive({ suppressNotifications: true }).then(() => {
                 // If load is successful, status will be updated by loadDataFromDrive
             }).catch(err => {
                 console.error("Error during auto-load after sign-in:", err);
                 // loadDataFromDrive already handles status/notifications
             });
        } else {
             // API not yet loaded, status will be updated when onApiLoadComplete fires
             setDriveStatus("Signed in. Waiting for Google API...", 'info');
        }

        updateSignInStatus(); // Update buttons now that we are signed in
    }


    // --- Google API Client Library Initialization ---
    // This function is called by the GAPI script's onload attribute
    function gapiLoaded() {
         // console.log("gapiLoaded callback fired."); // Debug log
        gapi.load('client', initializeGapiClient);
        // console.log("GAPI client library loaded.");
    }

    function initializeGapiClient() {
        // console.log("initializeGapiClient function called."); // Debug log
        // Initialize the client library (no API key needed for OAuth flows)
        gapi.client.init({})
            .then(() => {
                // Library is initialized, NOW load the specific Drive API
                // console.log("GAPI client core initialized. Loading Drive API..."); // Debug log
                return gapi.client.load('drive', 'v3'); // Load Drive v3 API
            })
             .then(() => {
                 // Drive API is loaded!
                 // console.log("Google Drive API v3 loaded successfully."); // Debug log
                 isApiLoaded = true; // Set the flag

                 // Now that both client and Drive API are loaded:
                 onApiLoadComplete(); // Call the function to handle post-load setup

             })
            .catch((error) => {
                console.error("Error initializing GAPI client or loading Drive API:", error); // Debug log
                 setDriveStatus("Error initializing Google Drive.", 'error');
                 showNotification("Could not initialize Google Drive integration.", true);
                 isApiLoaded = false; // Ensure flag is false on failure
                 updateSignInStatus(); // Update buttons based on failure
            });
    }

    // Actions to perform once GSI token client is ready AND GAPI client + Drive API are loaded
    function onApiLoadComplete() {
         // console.log("onApiLoadComplete called."); // Debug log

        // Attempt to load file ID from localStorage
        plannerFileId = localStorage.getItem(`${localStorageKey}_fileId`);
        // console.log("Initial plannerFileId check from localStorage (onApiLoadComplete):", plannerFileId); // Debug log

        setupButtonListeners(); // Setup listeners now that all APIs are potentially available

        // Update buttons based on current sign-in state (if any) and API loaded status
        updateSignInStatus();

        // If already signed in (e.g., page reload after auth), auto-load data from Drive
         if (accessToken) {
             setDriveStatus("Signed in. Loading data from Google Drive...", 'info');
             loadDataFromDrive({ suppressNotifications: true }).then(() => {
                 // If load is successful, status will be updated by loadDataFromDrive
             }).catch(err => {
                 console.error("Error during auto-load after API load (signed in):", err);
                 // loadDataFromDrive already handles status/notifications
             });
         } else {
             // Not signed in, API is loaded. Prompt user to sign in.
             setDriveStatus("Google Drive ready. Sign in to load/save.", 'info');
         }
         // console.log("onApiLoadComplete finished."); // Debug log
    }


    // --- Handle Google Sign-in/Sign-out ---
     function handleAuthClick() {
         // console.log("Sign In button clicked, handleAuthClick called."); // Debug log
         if (!tokenClient) {
             console.error("Token client not initialized when trying to sign in."); // Debug log
              setDriveStatus("Google Sign-in not ready.", 'error');
              showNotification("Google Sign-in is not ready. Please refresh.", true);
              return;
         }
         if (!isApiLoaded) {
             console.warn("API not fully loaded, cannot initiate auth flow that leads to API calls."); // Debug log
             setDriveStatus("Please wait for Google Drive to load.", 'info');
             showNotification("Please wait for Google Drive to finish loading.", false, true);
             return;
         }
         setDriveStatus("Signing in...", 'info');
         // requestAccessToken will trigger the handleGsiCallback upon completion
         tokenClient.requestAccessToken();
     }

    function handleSignoutClick() {
        // console.log("Sign Out button clicked, handleSignoutClick called."); // Debug log
        if (accessToken) {
             // Google Identity Services doesn't have a synchronous 'signOut' like gapi.auth2
             // Setting the token to null effectively signs out the current session for gapi.client
             gapi.client.setToken(null);
             accessToken = null;
             // We *don't* clear plannerFileId or localStorage here, as the file still exists,
             // it's just that *this user* is no longer signed in. Another user on the same
             // computer might sign in and need the same file ID.
             // plannerFileId is kept. localStorage is kept.

             // Cancel any pending autosave attempt that might try to save to Drive
             clearTimeout(autosaveTimer);
             pendingAutoSave = false;

             setDriveStatus("Signed out.", 'info');
             // console.log("Successfully signed out."); // Debug log
             updateSignInStatus(); // Disable buttons
             showNotification("Signed out of Google Drive.", false, true); // Info notification
        } else {
             // console.log("Sign Out clicked but no access token was active."); // Debug log
             setDriveStatus("Already signed out.", 'info');
        }
    }

    // --- UI Update Functions ---
    function updateSignInStatus() {
        const signedIn = !!accessToken;
        // The isApiLoaded flag now correctly represents if gapi.client.drive is ready
        const apiReady = isApiLoaded;

        signInButton.hidden = signedIn || !apiReady; // Hide sign-in if signed in or API not ready
        signOutButton.hidden = !signedIn;

        // Hide manual save/load buttons by default, only show if API ready
        saveToDriveButton.hidden = !apiReady;
        loadFromDriveButton.hidden = !apiReady;

        // Manual buttons are enabled ONLY if signed in AND API ready
        saveToDriveButton.disabled = !(signedIn && apiReady);
        loadFromDriveButton.disabled = !(signedIn && apiReady);


        // Update the status message
        if (!apiReady) {
            setDriveStatus("Loading Google API...");
        } else if (!signedIn) {
            setDriveStatus("Google Drive ready. Sign in to load/save.", 'info');
        } else {
            // Signed in, API loaded. Check if file ID is known or being found.
             if (!plannerFileId) {
                setDriveStatus("Signed in. Searching for planner file...", 'info');
             } else {
                 // Status will be updated to "Saved successfully." or similar after auto-save/load
                 // Or just indicate ready state if no pending operation
                 if (!pendingAutoSave) { // Only show 'ready' if no save/load operation is ongoing
                     setDriveStatus("Signed in. Auto-save enabled.", 'success');
                 }
             }
        }
         // console.log(`Update Sign In Status: SignedIn=${signedIn}, ApiReady=${apiReady}, FileIdPresent=${!!plannerFileId}`); // Debug log
    }

     // --- Google Drive File Management Functions ---

     /**
      * Saves data to localStorage as a fallback.
      */
     function saveDataToLocalStorage() {
        const data = collectPlannerData();
        try {
            localStorage.setItem(localStorageKey, JSON.stringify(data));
             // console.log("Data saved to localStorage.");
             // showNotification("Changes saved to browser storage.", false, true); // Optional: too frequent?
             setDriveStatus(accessToken ? "Signed in. Saved to browser (pending Drive auto-save)." : "Signed out. Saved to browser.", 'info');
        } catch (error) {
             console.error("Error saving data to localStorage:", error);
             if (error.name === 'QuotaExceededError' || error.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                 showNotification("Error saving data: Browser storage full. Clear space or sign in to Drive.", true);
             } else {
                 showNotification("Error saving to browser storage: " + error.message, true);
             }
        }
     }

     /**
      * Attempts to save data to Google Drive if signed in and API is loaded,
      * otherwise falls back to localStorage.
      */
    async function autoSave() {
        // console.log("autoSave triggered."); // Debug log
        if (accessToken && isApiLoaded) {
            // Clear any pending localStorage save initiated by this debounced call
            // (assuming localStorage save might have been triggered immediately by input before debounce)
            // This is complex. Let's simplify: debounced save *only* saves to Drive if signed in.
            // Immediate input triggers are handled separately if needed, but debounce works for notes/text.

            // Check file ID first
            try {
                const fileId = await findOrCreatePlannerFile(); // Ensure file exists and ID is known
                 if (!fileId) {
                     // findOrCreatePlannerFile should throw or set status, but as safeguard:
                      showNotification("Could not get valid file ID for auto-save. Saving to browser.", true, true);
                      saveDataToLocalStorage(); // Fallback
                      return;
                 }
                // console.log("Auto-saving to Google Drive..."); // Debug log
                setDriveStatus("Auto-saving to Google Drive...", 'info');
                // No need to disable button as this is automatic

                const data = collectPlannerData(); // Collect data from the page
                const jsonContent = JSON.stringify(data, null, 2); // Stringify with formatting

                // Update the file content using the 'upload' endpoint with PATCH
                const boundary = '-------314159265358979323846';
                const delimiter = "\r\n--" + boundary + "\r\n";
                const closeDelimiter = "\r\n--" + boundary + "--";

                const metadata = { 'mimeType': 'application/json' };

                let multipartRequestBody =
                    delimiter + 'Content-Type: application/json\r\n\r\n' +
                    JSON.stringify(metadata) +
                    delimiter + 'Content-Type: application/json\r\n\r\n' +
                    jsonContent +
                    closeDelimiter;

                 // Use a regular request, not gapi.client.drive.files.update which has issues with multipart
                const response = await gapi.client.request({
                    path: '/upload/drive/v3/files/' + fileId,
                    method: 'PATCH',
                    params: { uploadType: 'multipart' },
                    headers: { 'Content-Type': 'multipart/related; boundary="' + boundary + '"' },
                    body: multipartRequestBody
                });

                // console.log("Auto-save successful:", response); // Debug log
                // showNotification("Auto-saved to Google Drive!", false); // Optional: maybe too frequent?
                 setDriveStatus("Signed in. Auto-saved.", 'success');

            } catch (error) {
                console.error("Error during auto-save to Google Drive:", error); // Debug log
                 const errorMessage = error.result?.error?.message || error.body?.error?.message || error.message || "Unknown error";
                 showNotification(`Auto-save failed: ${errorMessage}. Saving to browser storage.`, true); // Error + Fallback info
                 setDriveStatus(`Auto-save failed. Error: ${errorMessage}`, 'error');
                 saveDataToLocalStorage(); // Fallback to localStorage on Drive save failure
                 // If auth error (401), the status update will handle it.
            } finally {
                 updateSignInStatus(); // Ensure buttons are correct
            }
        } else {
            // Not signed in or API not loaded, save to localStorage
            saveDataToLocalStorage();
        }
    }


    /**
     * Loads planner data from the file in Google Drive.
     * @param {object} [options]
     * @param {boolean} [options.suppressNotifications=false] - Don't show success/error notifications.
     * @param {boolean} [options.suppressStatus=false] - Don't update drive status messages.
     */
    async function loadDataFromDrive(options = {}) {
        const { suppressNotifications = false, suppressStatus = false } = options;

        // console.log("loadDataFromDrive called."); // Debug log
        if (!accessToken) {
             if (!suppressNotifications) showNotification("Please sign in to Google Drive first.", false, true); // Info, not error
             if (!suppressStatus) setDriveStatus("Sign in to load/save.", 'info');
            handleAuthClick(); // Prompt sign-in
            return; // Stop execution until signed in
        }
         if (!isApiLoaded) {
              if (!suppressNotifications) showNotification("Google Drive API is not loaded yet.", false, true); // Info
             if (!suppressStatus) setDriveStatus("Please wait for Google Drive to load.", 'info');
             return;
         }

         if (!suppressStatus) setDriveStatus("Loading from Google Drive...", 'info');
         loadFromDriveButton.disabled = true; // Disable manual load button

        try {
            const fileId = await findOrCreatePlannerFile(); // Ensure file exists and ID is known
             if (!fileId) {
                 // findOrCreatePlannerFile should throw or set status, but as safeguard:
                  if (!suppressNotifications) showNotification("Could not find/create file ID for loading.", true);
                 return; // Can't load without a file ID
             }
              // console.log("Loading data from file ID:", fileId); // Debug log

            // Get file content using alt=media parameter
            const response = await gapi.client.drive.files.get({
                fileId: fileId,
                alt: 'media' // Specify that we want the file content
            });

            const loadedData = response.result; // The response.result directly contains the JSON parsed object
            // console.log("Load successful:", loadedData); // Debug log

            // Apply the loaded data to the page
            applyPlannerData(loadedData);

            // Optional: Clear localStorage after successful Drive load to prioritize Drive data
             localStorage.removeItem(localStorageKey);
             // console.log("Cleared localStorage after successful Drive load.");

             if (!suppressNotifications) showNotification("Planner loaded from Google Drive!", false); // Success notification
             if (!suppressStatus) setDriveStatus("Loaded successfully.", 'success');

        } catch (error) {
            console.error("Error loading from Google Drive:", error); // Debug log
             const errorMessage = error.result?.error?.message || error.body?.error?.message || error.message || "Unknown error";
             if (!suppressNotifications) showNotification(`Error loading from Drive: ${errorMessage}`, true); // Error notification
             if (!suppressStatus) setDriveStatus(`Load failed. Error: ${errorMessage}`, 'error');
             // If the error is authentication related (401), the status update will handle it.
        } finally {
             loadFromDriveButton.disabled = false; // Re-enable manual load button
             updateSignInStatus(); // Ensure buttons are correct
        }
    }


     /**
      * Loads data from localStorage first. Called on DOMContentLoaded.
      */
    function initialLoadFromLocalStorage() {
        // console.log("Starting initialLoadFromLocalStorage."); // Debug log
        const savedDataString = localStorage.getItem(localStorageKey);
        let dataLoaded = false;

        if (savedDataString) {
             try {
                const savedData = JSON.parse(savedDataString);
                if (savedData) {
                    applyPlannerData(savedData); // applyPlannerData will call necessary calculations
                    dataLoaded = true;
                    // console.log("Data loaded successfully from localStorage."); // Debug log
                     showNotification("Loaded data from your browser.", false, true); // Info notification
                } else {
                     // console.log("localStorage key found but data was empty or null."); // Debug log
                }
            } catch (error) {
                console.error("Error parsing data from localStorage:", error); // Debug log
                 localStorage.removeItem(localStorageKey); // Clear potentially corrupted data
                 showNotification("Error loading data from browser storage. It might be corrupted. Loading default plan.", true);
            }
        }

        if (!dataLoaded) {
            // If no data loaded from localStorage, ensure default HTML is correctly initialized
             // console.log("No valid data in localStorage. Using default HTML structure."); // Debug log
             // These are already done on DOMContentLoaded for the static HTML, but let's ensure:
             initializeAllRibaDropdowns();
             calculateAllSemestersCredits();
             calculateAllSemestersUnusedRiba();
             updateRibaSummaryTable();
        }

         // After initial load from localStorage, we wait for Google API to load.
         // The status will be updated by updateSignInStatus.
         // console.log("initialLoadFromLocalStorage finished. Waiting for Google API."); // Debug log
    }


     // --- Data Collection and Application Functions ---

     // Collects all data from the HTML planner into a JSON object
     function collectPlannerData() {
        const data = {
            semesters: {},
            summaries: {},
            generalNotes: document.getElementById('general-notes-area').value.trim() // Use .value for textarea
        };

        semesterIds.forEach(semId => {
            const tableId = `${semId}-table`;
            const table = document.getElementById(tableId);
            if (!table) return;

            const tbody = table.getElementsByTagName('tbody')[0];
            const rows = tbody.querySelectorAll('tr:not(.total-credits-row)'); // Select rows that are not the total row
            const semesterData = [];
            rows.forEach(row => {
                const cells = row.getElementsByTagName('td');
                 if (cells.length < 12) { // Ensure we have enough cells
                      console.warn(`Skipping row in ${tableId} due to unexpected number of cells (${cells.length})`, row);
                      return;
                 }
                // Capture data from the first 11 cells (indices 0-10)
                const course = {
                    code: cells[0].textContent.trim(), // Text field
                    title: cells[1].textContent.trim(), // Text field
                    credits: cells[2].textContent.trim(), // Text field (will be parsed to int on load)
                    defaultRibaTheme: cells[3].querySelector('select.riba-select')?.value || "", // Select value
                    acadRibaDirect: cells[4].querySelector('select.riba-select')?.value || "", // Select value
                    academicNotes: cells[5].innerHTML.trim(), // innerHTML for multi-line notes
                    ethicsRibaDirect: cells[6].querySelector('select.riba-select')?.value || "", // Select value
                    ethicsNotes: cells[7].innerHTML.trim(), // innerHTML for multi-line notes
                    techRibaDirect: cells[8].querySelector('select.riba-select')?.value || "",  // Select value
                    techNotes: cells[9].innerHTML.trim(), // innerHTML for multi-line notes
                    remarks: cells[10].innerHTML.trim() // innerHTML for multi-line remarks
                };
                semesterData.push(course);
            });
            data.semesters[semId] = semesterData;

            // Save Summary Data
            const summaryElement = document.getElementById(`${semId}-summary`);
            if (summaryElement) {
                data.summaries[semId] = summaryElement.innerHTML.trim(); // Use innerHTML for summary
            }
        });
         // console.log("Collected Planner Data:", data); // Debug log
        return data;
     }

     // Applies loaded data to the HTML planner
     function applyPlannerData(data) {
        // console.log("Applying Planner Data:", data); // Debug log
        if (!data) {
            console.warn("No data provided to apply.");
            return;
        }

        // Apply general notes
        const generalNotesArea = document.getElementById('general-notes-area');
        if (generalNotesArea && data.generalNotes !== undefined) {
            generalNotesArea.value = data.generalNotes;
        } else if (generalNotesArea) {
             generalNotesArea.value = ""; // Clear if data is missing notes
        }


        // Apply semester data
        semesterIds.forEach(semId => {
            const tableId = `${semId}-table`;
            const table = document.getElementById(tableId);
             const summaryElement = document.getElementById(`${semId}-summary`);

            if (!table) {
                 console.warn(`Table element not found for semester ${semId}. Skipping.`);
                 return;
             }

            const tbody = table.getElementsByTagName('tbody')[0];
             // Clear existing data rows (keep header and total row if they exist in HTML)
             const existingRows = tbody.querySelectorAll('tr:not(.total-credits-row)');
             existingRows.forEach(row => row.remove());
             // console.log(`Cleared existing rows for ${tableId}`); // Debug log


            if (data.semesters && data.semesters[semId] && Array.isArray(data.semesters[semId])) {
                // console.log(`Loading ${data.semesters[semId].length} courses for ${semId}.`); // Debug log
                 data.semesters[semId].forEach(course => {
                     // Use addCourseRevised to add rows from data, which handles dropdowns and initial calculations
                     addCourseRevised(tableId, course);
                 });
            } else {
                // console.log(`No course data found for ${semId} in the loaded data.`); // Debug log
                // If no data for this semester in the loaded file,
                // ensure default HTML rows (if any) are correctly initialized.
                // This is handled by initializeAllRibaDropdowns called *after* this loop.
            }

            // Apply Summary Data
            if (summaryElement && data.summaries && data.summaries[semId] !== undefined) {
                 summaryElement.innerHTML = data.summaries[semId];
                 // console.log(`Applied summary for ${semId}.`); // Debug log
            } else if (summaryElement) {
                 // Optionally reset summary to default if missing in data, or clear it
                 // console.log(`No summary data found for ${semId} or data missing.`); // Debug log
                 // For simplicity, we keep the original HTML default summary if loaded data is missing it.
                 // You might want to reset it to "" here depending on desired behavior.
            }
        });

         // After processing all semesters, re-initialize dropdowns and recalculate totals/summaries
         // This ensures any default rows not overwritten by data also have correct state and calculations.
         // addCourseRevised called within the loop handles this for loaded rows, but this catches defaults.
         // console.log("Applying data complete. Re-initializing UI and recalculating."); // Debug log
         initializeAllRibaDropdowns(); // Re-populate ALL selects in the DOM
         calculateAllSemestersCredits();
         calculateAllSemestersUnusedRiba();
         updateRibaSummaryTable();
     }


    // --- Populate RIBA Dropdowns ---
    function populateRibaSelect(selectElement, selectedValue = "") {
        // Store current value if it exists
        const currentValue = selectedValue || selectElement.value;

        // Clear existing options
        selectElement.innerHTML = '';

        // Add a default "Select" option
        const defaultOption = document.createElement('option');
        defaultOption.value = "";
        defaultOption.textContent = "Select";
        selectElement.appendChild(defaultOption);

        // Add RIBA themes
        ribaThemes.forEach(theme => {
            const option = document.createElement('option');
            option.value = theme;
            option.textContent = theme;
            selectElement.appendChild(option);
        });

        // Set the selected value after populating
        // Ensure the value is actually one of the options, otherwise default to "Select"
        if (currentValue && selectElement.querySelector(`option[value="${currentValue}"]`)) {
             selectElement.value = currentValue;
        } else {
             selectElement.value = ""; // Default to "Select" if value is null, empty, or invalid
        }
    }

    // Function to initialize dropdowns for *all* selects currently in the DOM
     function initializeAllRibaDropdowns() {
        const allSelects = document.querySelectorAll('select.riba-select');
        // console.log(`Initializing ${allSelects.length} RIBA dropdowns.`); // Debug log
        allSelects.forEach(select => {
            // If the select already has a 'value' attribute from HTML or a previous load, use it.
            // Otherwise, it will be the default empty string.
            const initialValue = select.getAttribute('value') || select.value;
            populateRibaSelect(select, initialValue);
             // Remove value attribute after populating to prevent issues
             select.removeAttribute('value');
        });
     }


    // --- Calculate Semester Credits ---
    function calculateSemesterCredits(tableId) {
        const table = document.getElementById(tableId);
        if (!table) {
             console.warn(`Table not found for credit calculation: ${tableId}`);
             return;
        }
        // Select credit cells using the data attribute for robustness
        const creditCells = table.querySelectorAll('tbody tr:not(.total-credits-row) td[data-cell-type="credits"]');
        let totalCredits = 0;
        creditCells.forEach(cell => {
            // Use textContent for safety and trim whitespace
            const creditValue = parseInt(cell.textContent.trim()) || 0;
            totalCredits += creditValue;
        });
        const totalCell = table.querySelector('tbody tr.total-credits-row td:nth-child(2)'); // The cell displaying the total
        if (totalCell) {
            totalCell.textContent = totalCredits;
             // console.log(`Calculated total credits for ${tableId}: ${totalCredits}`); // Debug log
        } else {
             console.warn("Could not find total credits cell for table:", tableId);
        }
    }

     // --- Calculate All Semester Credits ---
     function calculateAllSemestersCredits() {
         // console.log("Calculating all semester credits."); // Debug log
        semesterIds.forEach(semId => {
             const tableId = `${semId}-table`;
             // Check if table exists before calculating
             if(document.getElementById(tableId)){
                 calculateSemesterCredits(tableId);
             }
         });
     }

     // --- Calculate and Display Unused RIBA Themes for a Semester ---
     function calculateUnusedRiba(tableId) {
         const table = document.getElementById(tableId);
         if (!table) {
             console.warn(`Table not found for unused RIBA calculation: ${tableId}`);
             return;
         }

         // Find the span element where the list should be displayed
         const unusedListId = tableId.replace('-table', '-unused-riba-list');
         const unusedListElement = document.getElementById(unusedListId);
         if (!unusedListElement) {
             console.warn(`Could not find unused RIBA list element with ID: ${unusedListId}`);
             return;
         }

         // Get all selected RIBA themes in this table
         // Selects are in columns 3, 4, 6, 8 (0-indexed are 3, 4, 6, 8) - these indices match the CSS
         const selectElements = table.querySelectorAll('tbody tr:not(.total-credits-row) td:nth-child(4) select, tbody tr:not(.total-credits-row) td:nth-child(5) select, tbody tr:not(.total-credits-row) td:nth-child(7) select, tbody tr:not(.total-credits-row) td:nth-child(9) select');
         const usedThemes = new Set();

         selectElements.forEach(select => {
             const value = select.value.trim();
             // Only add if a theme is actually selected AND it's one of the valid themes
             if (value !== "" && ribaThemes.includes(value)) {
                 usedThemes.add(value);
             }
         });

         // Determine unused themes
         const unusedThemes = ribaThemes.filter(theme => !usedThemes.has(theme));

         // Update the display
         if (unusedThemes.length === 0) {
             unusedListElement.textContent = "All RIBA themes used!";
         } else {
             unusedListElement.textContent = unusedThemes.join(', ');
         }
          // console.log(`Unused RIBA themes for ${tableId}: ${unusedThemes.length === 0 ? 'None' : unusedThemes.join(', ')}`); // Debug log
     }

    // --- Calculate All Semester Unused RIBA Themes ---
    function calculateAllSemestersUnusedRiba() {
        // console.log("Calculating all semester unused RIBA themes."); // Debug log
        semesterIds.forEach(semId => {
             const tableId = `${semId}-table`;
              // Check if table exists before calculating
              if(document.getElementById(tableId)){
                  calculateUnusedRiba(tableId);
              }
         });
    }

    // --- Update RIBA Summary Table ---
    function updateRibaSummaryTable() {
        // console.log("Updating RIBA Summary Table."); // Debug log
        const summaryTableBody = document.querySelector('#riba-summary-table tbody');
        if (!summaryTableBody) {
            console.error("RIBA summary table body not found.");
            return;
        }

        // Clear existing content
        summaryTableBody.innerHTML = '';

        // Initialize counts structure { theme: { sem1: 0, sem2: 0, ..., sem10: 0, total: 0 } }
        const themeCounts = {};
        ribaThemes.forEach(theme => {
            themeCounts[theme] = { total: 0 };
            semesterIds.forEach(semId => {
                themeCounts[theme][semId] = 0;
            });
        });

        // Iterate through each semester table
        semesterIds.forEach(semId => {
            const table = document.getElementById(`${semId}-table`);
            if (!table) {
                 console.warn(`Table not found for summary calculation: ${semId}`);
                 return;
            }

            const rows = table.querySelectorAll('tbody tr:not(.total-credits-row)');

            // Iterate through each course row in the semester
            rows.forEach(row => {
                const selectElements = row.querySelectorAll('td select.riba-select'); // Get all selects in the row
                 selectElements.forEach(select => {
                    const selectedTheme = select.value.trim();
                    // Only count if a theme is selected and it's a valid RIBA theme
                    if (selectedTheme !== "" && ribaThemes.includes(selectedTheme)) {
                         if (themeCounts[selectedTheme]) { // Check if theme exists in our counts structure
                              const countCellIndex = semesterIds.indexOf(semId); // Find column index for semester
                              if (countCellIndex !== -1) {
                                   themeCounts[selectedTheme][semId]++;
                                   themeCounts[selectedTheme].total++;
                              } else {
                                  console.warn(`Could not find index for semester ID ${semId} in semesterIds array.`);
                              }
                         } else {
                             // This case should ideally not happen if ribaThemes is comprehensive
                             console.warn(`Unexpected theme selected: "${selectedTheme}"`);
                         }
                    }
                });
            });
        });

        // Populate the summary table body
        ribaThemes.forEach(theme => {
            const row = document.createElement('tr');

            // Theme name cell (sticky left)
            const themeCell = document.createElement('td'); // Using td for content, th in header
            themeCell.textContent = theme;
            row.appendChild(themeCell);

            // Counts per semester
            semesterIds.forEach(semId => {
                const countCell = document.createElement('td');
                countCell.textContent = themeCounts[theme][semId] || 0; // Display count, default to 0
                row.appendChild(countCell);
            });

            // Total count cell
            const totalCell = document.createElement('td');
            totalCell.textContent = themeCounts[theme].total || 0; // Display total count, default to 0
            totalCell.style.fontWeight = 'bold'; // Make total count bold
            totalCell.style.color = 'var(--primary-dark)'; // Highlight total
            row.appendChild(totalCell);

            summaryTableBody.appendChild(row);
        });
         // console.log("RIBA Summary Table updated."); // Debug log
    }


    // --- Add Course Functionality ---
    function addCourseRevised(tableId, courseData = null) {
        const table = document.getElementById(tableId);
        if (!table) {
             console.error(`Attempted to add course to non-existent table: ${tableId}`);
             return;
        }
        const tbody = table.getElementsByTagName('tbody')[0];
        const totalRow = tbody.querySelector('.total-credits-row');
        const newRow = document.createElement('tr');
        // console.log(`Adding new course row to ${tableId}. Data:`, courseData); // Debug log

        // Helper to create cells - handles 12 columns (11 data + 1 delete)
        const createCell = (content = "", isEditable = true, cellIndex, type = 'text') => {
            const cell = document.createElement('td');
            cell.setAttribute('spellcheck', 'false'); // Disable spellcheck for all editable cells

            if (type === 'select') {
                cell.classList.add('riba-cell');
                const select = document.createElement('select');
                select.classList.add('riba-select');
                // Set the initial value as an attribute, populateDropdown will read this
                if (content) {
                     select.setAttribute('value', content);
                }
                cell.appendChild(select);
                cell.setAttribute('contenteditable', 'false'); // Selects are not contenteditable
            } else if (type === 'delete') {
                 cell.classList.add('delete-cell');
                 const deleteButton = document.createElement('button');
                 deleteButton.classList.add('delete-row-button');
                 deleteButton.innerHTML = '&times;';
                 deleteButton.title = 'Delete Row';
                 // Event listener added via delegation later
                 cell.appendChild(deleteButton);
                 cell.setAttribute('contenteditable', 'false'); // Button cell is not contenteditable
            }
             else { // Text or rich content editable cells
                 cell.setAttribute('contenteditable', isEditable ? 'true' : 'false');

                 // Use innerHTML for notes/remarks/summaries to preserve formatting, textContent for others
                 // Indices 5, 7, 9, 10 are Notes/Remarks columns
                 // Summary cells use textContent
                 if (isEditable && (cellIndex === 5 || cellIndex === 7 || cellIndex === 9 || cellIndex === 10)) {
                     // Escape potential HTML in content before setting innerHTML
                      const tempDiv = document.createElement('div');
                      // Use textContent for safety first to escape any HTML
                      tempDiv.textContent = content || ''; // Ensure content is treated as text initially
                       // Now set the escaped text as innerHTML
                      cell.innerHTML = tempDiv.innerHTML; // This safely handles things like <&> and newlines
                 } else if (cellIndex === 2 && isEditable) {
                     // Credits cell: ensure it's treated as text input for editing but stored as int
                     cell.textContent = content || ''; // Allow initial content as string "0" or number
                     cell.setAttribute('data-cell-type', 'credits'); // Mark credits cell
                 }
                 else {
                     cell.textContent = content || ''; // Use textContent for simple fields (Code, Title, Summary Theme Name)
                 }
            }

            // Apply text alignment based on index (0-based) for main tables
            if (!tableId.includes('-summary')) { // Only apply to main tables
                 if (cellIndex === 2) { cell.style.textAlign = 'center'; } // Credits column
                 if (cellIndex === 11) { cell.style.textAlign = 'center'; } // Actions column
            }


          return cell;
     }

        // Create 12 cells based on courseData or defaults
        // Ensure we provide a default empty string if courseData or its properties are null/undefined
        newRow.appendChild(createCell(courseData?.code ?? '', true, 0)); // Code
        newRow.appendChild(createCell(courseData?.title ?? '', true, 1)); // Title
        newRow.appendChild(createCell(courseData?.credits ?? "0", true, 2)); // Credits (uses data-cell-type)
        newRow.appendChild(createCell(courseData?.defaultRibaTheme ?? '', false, 3, 'select')); // Default RIBA Select (Index 3)
        newRow.appendChild(createCell(courseData?.acadRibaDirect ?? '', false, 4, 'select')); // Acad RIBA Select (Index 4)
        newRow.appendChild(createCell(courseData?.academicNotes ?? '', true, 5));          // Acad Notes (innerHTML) (Index 5)
        newRow.appendChild(createCell(courseData?.ethicsRibaDirect ?? '', false, 6, 'select')); // Ethics RIBA Select (Index 6)
        newRow.appendChild(createCell(courseData?.ethicsNotes ?? '', true, 7));             // Ethics Notes (innerHTML) (Index 7)
        newRow.appendChild(createCell(courseData?.techRibaDirect ?? '', false, 8, 'select'));   // Tech RIBA Select (Index 8)
        newRow.appendChild(createCell(courseData?.techNotes ?? '', true, 9));               // Tech Notes (innerHTML) (Index 9)
        newRow.appendChild(createCell(courseData?.remarks ?? '', true, 10));                // Remarks (innerHTML) (Index 10)
        newRow.appendChild(createCell(null, false, 11, 'delete'));                   // Actions (Delete Button) (Index 11)


        if (totalRow) {
            tbody.insertBefore(newRow, totalRow);
        } else {
            tbody.appendChild(newRow);
        }

         // Populate dropdowns *after* the row is added to the DOM
         newRow.querySelectorAll('select.riba-select').forEach(select => {
             // Pass the value read from the 'value' attribute set by createCell
             populateRibaSelect(select, select.getAttribute('value') ?? ''); // Use ?? '' for safety
         });

        calculateSemesterCredits(tableId);
        calculateUnusedRiba(tableId); // Calculate unused RIBA after adding course
        updateRibaSummaryTable(); // Update the summary table
         // console.log(`Course row added to ${tableId}. Triggering auto-save.`); // Debug log
         debouncedAutoSave(); // Trigger autosave after adding a row
    }


    // --- Event Handler for UI Changes (triggering auto-save) ---
     function handleUIChange(event) {
         const target = event.target;

         // Handle specific cases first
         if (target.tagName === 'TD' && target.isContentEditable && target.getAttribute('data-cell-type') === 'credits') {
              handleCreditInput(event); // Handles its own immediate calculation
              debouncedAutoSave(); // Trigger autosave
         } else if (target.tagName === 'SELECT' && target.classList.contains('riba-select')) {
              handleRibaSelectChange(event); // Handles its own calculations (unused RIBA, summary)
              debouncedAutoSave(); // Trigger autosave
         } else if (target.isContentEditable || target.tagName === 'TEXTAREA') {
             // Any other contenteditable cell or the textarea
             // Autosave will be triggered by the debouncedAutoSave below
              debouncedAutoSave();
         }
         // Note: Delete button clicks trigger autosave within handleDeleteRow
         // Add Course button clicks trigger autosave within addCourseRevised
     }

     // --- Event Handler for Delete Row ---
     function handleDeleteRow(event) {
         // Check if the clicked element or its parent is the delete button
         const button = event.target.closest('.delete-row-button');
         if (!button) return; // Not a delete button click

         const row = button.closest('tr');
         if (!row) return; // Should not happen if button is found

         const table = row.closest('table');
         if (!table) return; // Should not happen if row is in a table

         // --- ADD CONFIRMATION DIALOG ---
         const cells = row.getElementsByTagName('td');
         let courseTitle = "this course";
         // Check cell index 1 for the title
         if (cells.length > 1 && cells[1].textContent.trim()) {
              courseTitle = `"${cells[1].textContent.trim()}"`;
         }

         if (!confirm(`Are you sure you want to delete ${courseTitle}? This action cannot be undone.`)) {
             return; // If user clicks Cancel, stop here
         }
         // --- END CONFIRMATION DIALOG ---

         const tableId = table.id; // Get tableId before removing the row
         row.remove(); // Remove the row from the DOM
         // console.log(`Row deleted from ${tableId}. Triggering auto-save.`); // Debug log

         calculateSemesterCredits(tableId); // Recalculate credits for the semester table
         calculateUnusedRiba(tableId); // Recalculate unused RIBA for the semester table
         updateRibaSummaryTable(); // Update the summary table
         debouncedAutoSave(); // Trigger autosave after deletion
     }


    // --- Initial Load (Try localStorage first) ---
    function initialLoadFromLocalStorage() {
        // console.log("Starting initialLoadFromLocalStorage."); // Debug log
        const savedDataString = localStorage.getItem(localStorageKey);
        let dataLoaded = false;

        if (savedDataString) {
             try {
                const savedData = JSON.parse(savedDataString);
                if (savedData) {
                    applyPlannerData(savedData); // applyPlannerData will call necessary calculations
                    dataLoaded = true;
                    // console.log("Data loaded successfully from localStorage."); // Debug log
                     showNotification("Loaded data from your browser.", false, true); // Info notification
                } else {
                     // console.log("localStorage key found but data was empty or null. Using default HTML."); // Debug log
                }
            } catch (error) {
                console.error("Error parsing data from localStorage:", error); // Debug log
                 localStorage.removeItem(localStorageKey); // Clear potentially corrupted data
                 showNotification("Error loading data from browser storage. It might be corrupted. Loading default plan.", true);
            }
        }

        if (!dataLoaded) {
            // If no data loaded from localStorage, ensure default HTML is correctly initialized
             // console.log("No valid data in localStorage. Using default HTML structure."); // Debug log
             // These are already done on DOMContentLoaded for the static HTML, but let's ensure:
             initializeAllRibaDropdowns();
             calculateAllSemestersCredits();
             calculateAllSemestersUnusedRiba();
             updateRibaSummaryTable();
        }

         // After initial load from localStorage, we wait for Google API to load.
         // The status will be updated by updateSignInStatus.
         setDriveStatus("Loading Google API..."); // Initial status while API loads
         // console.log("initialLoadFromLocalStorage finished. Waiting for Google API."); // Debug log
    }


    // --- Setup Event Listeners ---
    function setupButtonListeners() {
        // console.log("setupButtonListeners called."); // Debug log
        // Attach listeners for Google Drive buttons
        signInButton.addEventListener('click', handleAuthClick);
        signOutButton.addEventListener('click', handleSignoutClick);
        // Manual save/load buttons still call their dedicated functions
        saveToDriveButton.addEventListener('click', () => saveDataToDrive({ suppressNotifications: false }));
        loadFromDriveButton.addEventListener('click', () => loadDataFromDrive({ suppressNotifications: false }));


         // Use event delegation on the main planner div for ALL UI changes
         const plannerDiv = document.querySelector('.curriculum-planner');
         if(plannerDiv) {
             // Listen for 'input' on contenteditable cells and textarea
             plannerDiv.addEventListener('input', handleUIChange);

             // Listen for 'change' on select elements (RIBA dropdowns)
              plannerDiv.addEventListener('change', handleUIChange);

              // Listen for 'click' on delete buttons (handled inside handleDeleteRow)
              // handleDeleteRow itself calls debouncedAutoSave
              plannerDiv.addEventListener('click', function(event) {
                 const button = event.target.closest('.delete-row-button');
                 if(button) handleDeleteRow({ target: button }); // Pass the button as target
              });

              // Add Course button clicks also trigger autosave within addCourseRevised
         } else {
             console.error("Planner div not found! Event listeners not attached."); // Debug log
         }
         // console.log("setupButtonListeners finished."); // Debug log
    }


    // --- Entry Point: Load APIs and Initial Data ---
    document.addEventListener('DOMContentLoaded', () => {
        // console.log("DOMContentLoaded fired."); // Debug log

         // Start the initial data load from localStorage immediately to show something fast
         initialLoadFromLocalStorage();

         // GIS and GAPI scripts in head start loading async.
         // Their onload callbacks (gisLoaded, gapiLoaded) will handle
         // initializing the clients and then call onApiLoadComplete.

         // onApiLoadComplete will then:
         // 1. Set isApiLoaded = true
         // 2. Load plannerFileId from localStorage
         // 3. Call setupButtonListeners (enabling Drive buttons if signed in)
         // 4. Call updateSignInStatus (updating UI based on signed-in/API status)
         // 5. If signed in, trigger auto-load from Drive.

         // console.log("DOMContentLoaded handler finished. API loading async."); // Debug log
    });

    // Make necessary functions globally accessible for HTML elements
    window.addCourse = addCourseRevised;
    // Define global callback functions for Google scripts
    window.gisLoaded = gisLoaded;
    window.gapiLoaded = gapiLoaded;

    /* --- End of Refined JavaScript v8.3 --- */
</script>

</body>
</html>
